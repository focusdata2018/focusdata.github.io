<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Bitrix24 app tutorial</title>
    <!-- подключаем библиотеку BX24 
    <script src="https://api.bitrix24.com/api/v1/"></script>-->
	<!-- https://yandex.ru/dev/jslibs/#jquery -->
	<script src="https://yastatic.net/jquery/1.7.0/jquery.min.js"></script>
  </head>
  <body>
  
  <h1>Модуль автоматизации Bitrix</h1>
  
  <table>
  <tr>
  <td>
   <button onclick="create_cp_bill();">New CP bill</button>
  </td>
  <td>
   <button onclick="create_cp_bill();">New Uniexpress zakaz</button>
  </td>
  <td>
   <button onclick="create_cp_bill();">New Pochta blank</button>
  </td>
  </tr>
  
  <tr>
  <td>
  <div id="wndResult">...</div>
  </td>
  </tr>
  </table>
 
 <script>
 var g_dial={};
 
 </script>
 
 
  <script>
  //Получение данных по контакту
  function GetContact(id_contract)  
  {
	return new Promise(function(resolve,reject){
	     console.log("Step 1");
         resolve("test1");
    });
  }
  </script>

  <script>
  //Получение данных по товарам в сделке
  function GetProducts(id_contract)
  {
    return new Promise(function(resolve,reject){
	     console.log("Step 2");
         resolve("test2");
    });
  }
  </script>

  
  <script>
  
  function create_cp_bill()
  {
   
  //var info=BX24.placement.info();
  //g_dial.dial_id=info.options.ID;
  GetContact("1")
  .then(function(data){
    console.log(data);
	return GetProducts;
  },function(error){
     let _cur_error=jQuery("#wndResult").html();
     jQuery("#wndResult").html(_cur_error+'<br>'+error);
  })
  .then(function(data){
    console.log(data);
  },function(error){
     let _cur_error=jQuery("#wndResult").html();
     jQuery("#wndResult").html(_cur_error+'<br>'+error);
  });
  //alert(JSON.stringify(info));
  //jQuery("#wndResult").html(info);
  }
  

  
  </script>
  
  
    <script>
      /**
      * передаем методу  `init` в качестве параметра callback-функцию 
      * - наше приложение 
      */
    //  BX24.init(app);

      function app() {
        const initDate = BX24.getAuth();
        console.log("ititDate: ", initDate);
      }
    </script>
  </body>
</html>
